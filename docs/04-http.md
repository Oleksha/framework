[<< Предыдущая тема](03-error-handler.md) | [Следующая тема >>](05-router.md)

### HTTP

В `PHP` уже есть несколько встроенных элементов, облегчающих работу с `HTTP`. Например, есть [cуперглобальные переменные](http://php.net/manual/ru/language.variables.superglobals.php), содержащие информацию о запросе.

Этого будет достаточно, если вы просто хотите создать небольшое приложение, которое будет несложно поддерживать. Однако если вы хотите писать чистый, поддерживаемый, [SOLID](http://ru.wikipedia.org/wiki/SOLID_(программирование))-код, то вам нужен класс с хорошим объектно-ориентированным интерфейсом, который можно использовать в своем приложении.

И снова не потребовалось изобретать велосипед, я просто установил необходимый пакет. Некоторое время назад я написал свой собственный [компонент HTTP](https://github.com/PatrickLouys/http), потому что мне не нравились существующие компоненты, но вы можете выбрать любой из существующих.

Как альтернативу вы можете попробовать похожие пакетыы: [Symfony HttpFoundation](https://github.com/symfony/HttpFoundation), [Nette HTTP Component](https://github.com/nette/http), [Aura Web](https://github.com/auraphp/Aura.Web), [sabre/http](https://github.com/fruux/sabre-http)

В этом руководстве я буду использовать свой собственный HTTP-компонент, но вы, конечно, можете использовать любой понравившийся вам пакет. Вам просто нужно будет самостоятельно адаптировать код из этого руководства под него. 

Отредактируйте файл `composer.json`, добавив новый компонент, а затем запустите `composer update`:

```json
  "require": {
    "php": ">=7.0.0",
    "filp/whoops": "~2.1",
    "patricklouys/http": "~1.4"
  },
```

Теперь в файле `Bootstrap.php` под кодом обработчика ошибок можно добавить следующее (и не забудьте удалить исключение):

```php
$request = new \Http\HttpRequest($_GET, $_POST, $_COOKIE, $_FILES, $_SERVER);
$response = new \Http\HttpResponse;
```

Таким образом, создаются объекты `Request` и `Response`, которые можно использовать в других классах для получения данных запроса и отправки ответа браузеру.

Для того чтобы отправить ответ, необходимо добавить следующий фрагмент кода в конец файла `Bootstrap.php`:

```php
foreach ($response->getHeaders() as $header) {
    header($header, false);
}

echo $response->getContent();
```

При этом данные ответа будут отправлены браузеру. Если этого не сделать, то ничего не произойдет, так как объект `Response` будет хранить только данные. В большинстве других HTTP-компонентов, где классы отправляют данные обратно браузеру в качестве побочного эффекта, эта операция выполняется иначе, поэтому имейте это в виду, если используете другой компонент.

Второй параметр `header()` равен false, поскольку в противном случае существующие заголовки будут перезаписаны.

В настоящий момент компонент просто отправляет браузеру пустой ответ с кодом состояния `200`; чтобы изменить это, добавьте следующий код между фрагментами кода, приведенными выше (прямо поверх оператора `foreach`):

```php
$content = '<h1>Hello World</h1>';
$response->setContent($content);
```

Если вы хотите попробовать ошибку `404`, используйте следующий код:

```php
$response->setContent('404 - Page not found');
$response->setStatusCode(404);
```

Помните, что объект хранит только данные, поэтому если вы зададите несколько кодов состояния перед отправкой ответа, то будет применен только последний из них.

В следующих частях я покажу, как использовать различные возможности компонентов. А пока не стесняйтесь читать [документацию](https://github.com/PatrickLouys/http) или исходный код, если хотите узнать, как что-то работает.

[<< Предыдущая тема](03-error-handler.md) | [Следующая тема >>](05-router.md)
