[<< Предыдущая тема](02-composer.md) | [Следующая тема >>](04-http.md)

### Обработчик ошибок

Обработчик ошибок позволяет настроить, что будет происходить, если во время работы приложения возникнет ошибка.

Красивая error-страница с большим количеством информации необходимой для отладки очень помогает при разработке. Поэтому первой библиотекой которую мы включим в наше приложение будит библиотека обработки ошибок. 

Мне нравится библиотека [filp/whoops](https://github.com/filp/whoops), поэтому я покажу, как можно установить этот пакет в наш проект проекта. Если вы предпочитаете что-то другое, смело берите и устанавливайте его. В этом и состоит прелесть программирования без фреймворка – вы полностью контролируете свой проект.

Альтернативной библиотекой может быть пакет: [PHP-Error](https://github.com/JosephLenton/PHP-Error)

Чтобы установить новую библиотеку, откройте `composer.json` и добавьте нужный пакет в раздел `require`. Теперь этот раздел должен выглядеть следующим образом:

```php
"require": {
    "php": ">=7.0.0",
    "filp/whoops": "~2.1"
},
```

Теперь запустите команду `composer update` в консоли и библиотека будет установлена в вашем приложении.

Но пока вы не сможете его использовать. PHP пока не знает, где найти файлы классов установленной библиотеки. Идеально, если это будет автозагрузчик [PSR-4](http://www.php-fig.org/psr/psr-4/). `Composer` уже позаботился об этом, поэтому вам остается только добавить строку `require __DIR__ . '/../vendor/autoload.php';` в файл `Bootstrap.php`. 

**Важно:** Никогда не отображайте какие-либо ошибки для пользователя вашего приложения. Трассировка стека или даже простейшее сообщение об ошибке может помочь кому-либо получить доступ к вашей системе. Всегда показывайте пользователям только заглушку-предупреждение, например `404`, а для себя сохраняйте текст ошибки в логи, отправляйте на email или т.п. Помните, только вы должны видеть из-за чего произошла ошибка.

В режиме разработки вы должны видеть все, поэтому вам нужна страница выводящая информацию об ошибки и будет приятно если она будет еще и красивой. Решить это помогает переключатель который будет переключать режимы работы нашего приложения. На время разработки переключатель будет установлен в режим `development`.

После устанвки обработчика ошибок, добавьте вручную исключение (`Exception`), чтобы проверить, все ли работает правильно. Ваш файл Bootstrap.php может выглядеть примерно так:

```php
<?php declare(strict_types = 1);

namespace Example;

require __DIR__ . '/../vendor/autoload.php';

error_reporting(E_ALL);

$environment = 'development';

/**
* Регистрация обработчика ошибок
**/
$whoops = new \Whoops\Run;
if ($environment !== 'production') {
    $whoops->pushHandler(new \Whoops\Handler\PrettyPageHandler);
} else {
    $whoops->pushHandler(function($e){
        echo 'Todo: Friendly error page and send an email to the developer';
    });
}
$whoops->register();

throw new \Exception;

```

Вы должны увидеть страницу ошибок с подсвеченной строчкой, где произошло исключение. Если не видите, вернитесь на шаг назад и отладьте код, пока он не станет работать должным образом. Сейчас как раз самое время для очередного коммита.

[<< Предыдущая тема](02-composer.md) | [Следующая тема >>](04-http.md)
